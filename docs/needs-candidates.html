<!DOCTYPE html>
<html>
<head>
    <title>Districts Needing Candidates</title>
<meta charset='utf-8' />
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

<!-- Pull in the mapbox libraries -->
<script src='https://api.mapbox.com/mapbox-gl-js/v1.11.1/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v1.11.1/mapbox-gl.css' rel='stylesheet' />


<!-- Set style for all the objects in CSS -->
<style>

body {
    margin: 0;
    padding: 0;
}

h2,
h3 {
    margin: 10px;
    font-size: 1.2em;
}

h3 {
    font-size: 1em;
}

p {
    font-size: 0.85em;
    margin: 10px;
    text-align: left;
}

/**
* Create a position for the map
* on the page */
#map {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 100%;
}

/**
* Set rules for how the map overlays
* (information box and legend) will be displayed
* on the page. */
.map-overlay {
    position: absolute;
    bottom: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.8);
    margin-right: 20px;
    font-family: Arial, sans-serif;
    overflow: auto;
    border-radius: 3px;
}

#features {
    top: 5;
    height: 200px;
    margin-top: 20px;
    width: 250px;

}


</style>
</head>


<body>

<!-- Set up the geocoder aesthetics and pull in the saved scripts necessary for it to run -->
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css' type='text/css' />
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
<style>
#geocoder-container > div {
min-width:50%;
margin-left:25%;
}
</style>

<!-- Place the map -->
<div id='map'></div>


<!-- Place and title the info box -->
<div class='map-overlay' id='features'><h2>Search your address to find your ANC district</h2><div id='pd'><p>Click on a district for more info
<!-- Add the dybamic district info -->
<div id='districts'>
</div>
</p></div></div>


<script>

// Set up the access token to be used
mapboxgl.accessToken = 'pk.eyJ1IjoiZGV2aW5icmFkeSIsImEiOiJjazB0aWMyb2IwYTJnM2hsb2twZm1namFoIn0.OUOlfILkB77LwrWhj_uqkQ';


// Pull in the map
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/devinbrady/ckct6u5ey0mgj1ho127gsjf2o'

});

// wait for map to load before adjusting it
map.on('load', function() {

    // make a pointer cursor
    map.getCanvas().style.cursor = 'default';

    // change info window on hover
    map.on('click', function (e) {
        var districts = map.queryRenderedFeatures(e.point)

            if (districts.length > 0) {
                var smd_name = districts[0].properties['smd_id'].replace('smd_', '')

                document.getElementById('pd').innerHTML = 
                    "<b>" + "District " + smd_name + "</b>"
                    + "<br>" + "<a href='ancs/districts/" + smd_name + ".html'>District Page</a>"
                    + "<br>Commissioner: " + districts[0].properties['current_commissioner']
                    + "<br>Candidates: " + districts[0].properties['list_of_candidates']


            } else {
            document.getElementById('pd').innerHTML = '<p>Click on a district for more info</p>';
        }
    });

});



// Set up and geocoder
var geocoder = new MapboxGeocoder({
    accessToken: mapboxgl.accessToken,
    marker: {
        color: 'orange'
    },
    mapboxgl: mapboxgl
});

map.addControl(geocoder);

map.addControl(new mapboxgl.NavigationControl());

// Set the latitude and latitude bounds for how the map should be displayed
// map.fitBounds([[-106.305577, 25.538105], [-92.647061, 36.787841]]);

</script>
</body>
</html>